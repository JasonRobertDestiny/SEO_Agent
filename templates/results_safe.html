<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEO分析报告 - SEO Agent Pro</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .score-badge {
            font-size: 2rem;
            font-weight: bold;
            padding: 20px;
            border-radius: 50%;
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }
        .score-excellent { background: linear-gradient(135deg, #28a745, #20c997); }
        .score-good { background: linear-gradient(135deg, #ffc107, #fd7e14); }
        .score-poor { background: linear-gradient(135deg, #dc3545, #e74c3c); }
        .ai-analysis { background: linear-gradient(135deg, #6f42c1, #e83e8c); }
        .result-card { transition: transform 0.2s; }
        .result-card:hover { transform: translateY(-5px); }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-chart-line"></i> SEO Agent Pro
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/history">
                    <i class="fas fa-history"></i> 历史记录
                </a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <h1 class="mb-4">
                    <i class="fas fa-chart-bar text-primary"></i> SEO分析报告
                </h1>
            </div>
        </div>

        {% for result in results %}
        {% if result.status == 'success' %}
        <div class="card result-card mb-4 shadow-sm">
            <div class="card-header bg-primary text-white">
                <h3 class="mb-0">
                    <i class="fas fa-globe"></i> {{ result.url }}
                </h3>
                <small>分析完成时间: {{ result.result.timestamp or '未知' }}</small>
            </div>
            
            <div class="card-body">
                <!-- SEO评分显示 -->
                <div class="row mb-4">
                    <div class="col-md-3 text-center">
                        {% set score = result.result.overall_score|int %}
                        {% if score >= 80 %}
                            {% set score_class = 'score-excellent' %}
                        {% elif score >= 60 %}
                            {% set score_class = 'score-good' %}
                        {% else %}
                            {% set score_class = 'score-poor' %}
                        {% endif %}
                        <div class="score-badge {{ score_class }}">
                            {{ score }}
                        </div>
                        <h5 class="mt-2">整体评分</h5>
                    </div>
                    
                    <div class="col-md-9">
                        <!-- AI分析内容 -->
                        {% if result.result.analysis %}
                        <div class="alert alert-info">
                            <h5><i class="fas fa-robot"></i> AI专家分析</h5>
                            <div class="ai-content">
                                {{ result.result.analysis|safe }}
                            </div>
                        </div>
                        {% endif %}
                        
                        <!-- 快速统计 -->
                        <div class="row">
                            <div class="col-md-4">
                                <div class="text-center">
                                    <h4 class="text-primary">{{ safe_get(result.result, 'raw_data.content_analysis.title_length', 0) }}</h4>
                                    <small>标题长度</small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="text-center">
                                    <h4 class="text-success">{{ safe_get(result.result, 'raw_data.content_analysis.h1_count', 0) }}</h4>
                                    <small>H1标签数</small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="text-center">
                                    <h4 class="text-info">{{ safe_get(result.result, 'raw_data.content_analysis.image_count', 0) }}</h4>
                                    <small>图片数量</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 操作按钮 -->
                <div class="row">
                    <div class="col-12 text-center">
                        <a href="/view_report/{{ result.analysis_id }}" class="btn btn-primary me-2">
                            <i class="fas fa-eye"></i> 查看详细报告
                        </a>
                        <a href="/download_report/{{ result.analysis_id }}" class="btn btn-success">
                            <i class="fas fa-download"></i> 下载报告
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        {% elif result.status == 'timeout' %}
        <div class="card result-card mb-4 shadow-sm border-warning">
            <div class="card-header bg-warning text-dark">
                <h3 class="mb-0">
                    <i class="fas fa-clock"></i> {{ result.url }}
                </h3>
                <small>分析超时</small>
            </div>
            <div class="card-body">
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <strong>分析超时:</strong> {{ result.error }}
                </div>
                <p>建议:</p>
                <ul>
                    <li>尝试分析更简单的网站页面</li>
                    <li>检查网站是否可以正常访问</li>
                    <li>稍后重试分析</li>
                </ul>
                <a href="/" class="btn btn-outline-primary">
                    <i class="fas fa-redo"></i> 重新分析
                </a>
            </div>
        </div>
        
        {% else %}
        <div class="card result-card mb-4 shadow-sm border-danger">
            <div class="card-header bg-danger text-white">
                <h3 class="mb-0">
                    <i class="fas fa-exclamation-circle"></i> {{ result.url }}
                </h3>
                <small>分析失败</small>
            </div>
            <div class="card-body">
                <div class="alert alert-danger">
                    <i class="fas fa-times-circle"></i>
                    <strong>错误:</strong> {{ result.error }}
                </div>
                <a href="/" class="btn btn-outline-primary">
                    <i class="fas fa-redo"></i> 重新分析
                </a>
            </div>
        </div>
        {% endif %}
        {% endfor %}

        <!-- 返回首页 -->
        <div class="row mt-4">
            <div class="col-12 text-center">
                <a href="/" class="btn btn-lg btn-outline-primary">
                    <i class="fas fa-home"></i> 返回首页
                </a>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
